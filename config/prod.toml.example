# NeuroQuantumDB Production Configuration
# ⚠️  CRITICAL: Review and customize all values before deployment!
# Last Updated: November 2025

[server]
host = "0.0.0.0"  # Bind to all interfaces (use reverse proxy/firewall for security)
port = 8080
workers = 8  # Should match CPU cores (adjust based on your hardware)
max_connections = 10000  # Conservative limit - adjust based on RAM (1000 connections ≈ 2GB RAM)
keep_alive = 75
client_timeout = 5000
client_shutdown = 5000

[database]
data_path = "/var/lib/neuroquantumdb/data"  # Production data path
max_connections = 500  # Higher for production load
connection_timeout_seconds = 30

# Buffer Pool Configuration
[buffer_pool]
pool_size = 4096  # Number of page frames in buffer pool (larger for production)
eviction_policy = "LRU"  # Options: "LRU" or "Clock"
enable_background_flush = true
flush_interval_seconds = 5
max_dirty_pages = 400  # 10% of pool_size

# Read-Ahead Prefetching Configuration
# Improves performance for sequential scans (full table scans, range queries)
# Typical speedup: 2-4x for sequential workloads, 8x on HDDs
prefetch_enabled = true  # Enable adaptive prefetching
prefetch_depth = 16  # Number of pages to prefetch ahead (higher for production SSDs/HDDs)
prefetch_threshold = 3  # Sequential accesses needed before prefetching starts

[jwt]
# ⚠️  SECURITY CRITICAL: JWT secret MUST be provided via environment variable!
# The secret is intentionally NOT stored in this file for security reasons.
# Set the environment variable: export NEUROQUANTUM_JWT_SECRET=$(openssl rand -base64 48)
# Minimum 32 characters required.
secret = ""
expiration_hours = 1  # Short expiration for security
refresh_threshold_minutes = 15
quantum_enabled = true  # Enable quantum-resistant features
algorithm = "HS256"
issuer = "neuroquantum-db"
audience = "neuroquantum-api"

# JWT Secret Key Rotation (Security Best Practice)
rotation_enabled = true  # Enable automatic key rotation
rotation_interval_days = 90  # Rotate keys every 90 days (industry standard)
rotation_grace_period_hours = 24  # Keep previous key valid for 24h during rotation

[rate_limit]
requests_per_hour = 10000  # Per user/IP - adjust based on expected load
burst_allowance = 100
enabled = true
strategy = "TokenBucket"

[cors]
# ⚠️  Update with your actual frontend domain(s)
allowed_origins = ["https://app.neuroquantumdb.com", "https://dashboard.neuroquantumdb.com"]
allowed_methods = ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
allowed_headers = ["Authorization", "Content-Type", "X-API-Key", "X-Request-ID", "X-Quantum-Level"]
expose_headers = ["X-RateLimit-Limit", "X-RateLimit-Remaining", "X-RateLimit-Reset", "X-Request-ID"]
max_age = 3600
allow_credentials = true

[security]
max_payload_size = 5242880  # 5MB - prevent memory exhaustion attacks
request_timeout_seconds = 60
security_headers = true  # Enable security headers (X-Frame-Options, etc.)
csrf_protection = false  # Disabled for API-only service (enable if serving HTML)
quantum_encryption = true  # Enable post-quantum cryptography
admin_ip_whitelist = ["127.0.0.1", "::1"]  # ⚠️  Add your admin IPs here

[security.circuit_breaker]
failure_threshold = 10  # Open circuit after 10 failures
success_threshold = 5   # Close circuit after 5 successes
timeout_seconds = 120   # Try again after 2 minutes
enabled = true

[monitoring]
metrics_enabled = true
prometheus_endpoint = "/metrics"
health_check_endpoint = "/health"
performance_stats = true
detailed_logging = false  # Disable in prod to reduce overhead
websocket_enabled = true

[logging]
level = "info"  # Use "warn" for even less verbosity in production
format = "Json"  # Structured JSON for log aggregation (ELK, Splunk, etc.)
file_path = "/var/log/neuroquantumdb/api.log"
max_file_size_mb = 100
max_files = 10
structured_logging = true

[tracing]
enabled = true
exporter = "otlp"  # Use OTLP for production (more flexible than Jaeger)
endpoint = "http://localhost:4317"  # OTLP gRPC endpoint (update for your collector)
sampling_rate = 0.1  # Sample 10% of requests to reduce overhead
service_name = "neuroquantumdb"
trace_level = "detailed"  # Detailed tracing for production debugging

# Optional: Add resource attributes for better trace identification
# [tracing.resource_attributes]
# environment = "production"
# datacenter = "us-east-1"
# cluster_id = "prod-cluster-01"

# Quantum Computing Configuration (Production)
# ⚠️  All API tokens should be provided via environment variables!
[quantum.annealing]
# Backend preference: "auto", "dwave", "braket", or "classical"
backend = "auto"
fallback_to_simulation = true  # Fall back to classical simulation if quantum unavailable

# D-Wave Quantum Annealer Configuration
[quantum.annealing.dwave]
# API token from D-Wave Leap account (set via DWAVE_API_TOKEN env var)
api_endpoint = "https://cloud.dwavesys.com/sapi/v2"
# solver = "Advantage_system6.4"  # Auto-select if not specified
num_reads = 2000  # More reads for production accuracy
annealing_time_us = 20
auto_scale = true
timeout_secs = 600  # Longer timeout for production

# AWS Braket Annealer Configuration
[quantum.annealing.braket]
# AWS credentials via environment variables or IAM role
region = "us-west-1"
device_arn = "arn:aws:braket:::device/qpu/d-wave/Advantage_system6"
num_shots = 2000
s3_bucket = "neuroquantum-production-results"
s3_prefix = "quantum-annealing"
timeout_secs = 600

# Gate-Based Quantum Computing Configuration
[quantum.gate]
# Backend preference: "auto", "ibm", "ionq", "braket", or "simulator"
backend = "auto"
fallback_to_simulation = true

# IBM Quantum Configuration
[quantum.gate.ibm]
# API token via IBM_QUANTUM_API_KEY env var
api_endpoint = "https://api.quantum.ibm.com/runtime"
backend_name = "ibm_brisbane"
num_shots = 2048  # More shots for production accuracy
error_mitigation = true
dynamic_decoupling = true
max_qubits = 127
timeout_secs = 600

# IonQ Configuration
[quantum.gate.ionq]
# API key via IONQ_API_KEY env var
api_endpoint = "https://api.ionq.co/v0.3"
target = "aria"  # Production: use real hardware
num_shots = 2048
error_mitigation = 2  # Full error mitigation for production
native_gates = false
timeout_secs = 600

# AWS Braket Gate-Based Configuration
[quantum.gate.braket]
# AWS credentials via environment variables or IAM role
region = "us-east-1"
device_arn = "arn:aws:braket:us-east-1::device/qpu/ionq/Aria-1"
num_shots = 2048
s3_bucket = "neuroquantum-production-results"
s3_prefix = "quantum-gate"
timeout_secs = 600
